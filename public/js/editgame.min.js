parseArgs=function(){var a=location.search.substring(1);if(""===a)return{};a=a.split("&");var b={};for(parameter of a){var c=parameter.split("=");b[c[0]]=unescape(c[1])}return b},function(){var a={apiKey:"AIzaSyDgNzcJS-zqj-I3yUUXJp7EXp-6Vd6XsOo",authDomain:"boardex-b8a9e.firebaseapp.com",databaseURL:"https://boardex-b8a9e.firebaseio.com",storageBucket:"boardex-b8a9e.appspot.com",messagingSenderId:"762957983152"};firebase.initializeApp(a)}();const a=firebase.auth(),b=firebase.database(),c=firebase.storage();!function(){var d=c.ref("games"),e=b.ref("games"),f=b.ref("ratings");Vue.use(VueFire),a.onAuthStateChanged(b=>{var c=new Vue({el:"#game_spec",data:{lastImg:"",imgFile:"",game:{title:"",desc:"",imgUrl:"",playerMin:"",playerMax:"",age:""},rating:{title:"",funRating:0,funTotal:0,funNum:0,diffRating:0,diffTotal:0,diffNum:0,chaRating:0,chaTotal:0,chaNum:0},isUpdateMode:!1,isUploading:!1,alertPlayer:!1,alertSuccess:!1,alertFaliure:!1,alertPermission:!1},firebase:{games:e,ratings:f},created:function(){if(args=parseArgs(),args.hasOwnProperty("t")&&""!=args.t){console.log("switched to update mode"),this.isUpdateMode=!0;var a=e.child(args.t);a.once("value",a=>{console.debug(a.val()),null==a.val()&&(location.href="404.html"),this.game=a.val(),this.game.title=a.key})}else console.log("switched to add mode")},methods:{editgame:function(){return this.alertPlayer=!1,this.alertSuccess=!1,this.alertFaliure=!1,this.alertPermission=!1,this.isUploading=!1,this.game.title=this.game.title.trim(),this.game.desc=this.game.desc.trim(),this.game.playerMin=parseInt(this.game.playerMin),this.game.playerMax=parseInt(this.game.playerMax),this.game.age=this.game.age.trim(),isValid=this.game.title&&this.game.desc&&this.game.imgUrl&&this.game.age&&this.game.playerMin&&this.game.playerMax,(this.game.playerMin<1||this.game.playerMax<this.game.playerMin)&&(this.alertPlayer=!0,isValid=!1),isValid?(this.isUploading=!0,void(this.isUpdateMode?this.updateGame():this.addGame())):void(this.alertFaliure=!0)},addGame:function(){requireImg=function(){console.log("missing image file")},add=function(){console.log("pushing"),f.child(c.game.title).set({funRating:0,funTotal:0,funNum:0,diffRating:0,diffTotal:0,diffNum:0,chaRating:0,chaTotal:0,chaNum:0}),e.child(c.game.title).set({desc:c.game.desc,imgUrl:c.game.imgUrl,playerMin:c.game.playerMin,playerMax:c.game.playerMax,age:c.game.age,uid:a.currentUser.uid}).then(function(a){this.alertSuccess=!0,location.href="info.html?t="+c.game.title},function(a){this.alertFaliure=!0})},this.uploadImageWithCallBack(requireImg,add)},updateGame:function(){update=function(){console.log("updating"),e.child(c.game.title).update({desc:c.game.desc,imgUrl:c.game.imgUrl,playerMin:c.game.playerMin,playerMax:c.game.playerMax,age:c.game.age}).then(function(a){this.alertSuccess=!0,location.href="info.html?t="+c.game.title},function(a){"PERMISSION_DENIED"===a.code?(this.alertFaliure||(this.alertPermission=!0),location.href="index.html"):this.alertFaliure=!0})},this.uploadImageWithCallBack(update,update)},onGameImageChange:function(a){var b=a.target.files||a.dataTransfer.files;if(!b.length)return void(c.game.imgUrl="");this.imgFile=b[0];var d=new FileReader;d.onload=function(a){c.game.imgUrl=a.target.result},d.readAsDataURL(this.imgFile)},uploadImageWithCallBack:function(b,e){if(!this.imgFile)return void b();if(this.imgFile==this.lastImg)return void e();console.log("uploading original image");var f=d.child(a.currentUser.uid+"/"+this.game.title+"/image"),g=f.put(this.imgFile);g.on("state_changed",function a(b){var a=b.bytesTransferred/b.totalBytes*100;console.log("uploading image: "+a)},function(b){console.log("upload failed!")},function(){console.log("upload complete!"),c.optimizeImg(g.snapshot.downloadURL,e),c.lastImg=c.imgFile})},optimizeImg:function(b,e){console.log("fetching optimized image");const f="https://res.cloudinary.com/law4d4rh3/image/fetch/",g="h_280,",h="q_40,",i="f_jpg/";optUrl=f+g+h+i+escape(b),console.debug(optUrl);var j=new Image;j.setAttribute("crossOrigin","anonymous"),j.onload=function(){var b=document.createElement("canvas");b.width=this.width,b.height=this.height;var f=b.getContext("2d");f.drawImage(this,0,0),console.debug("hehe"),b.toBlob(b=>{console.debug(b),console.log("uploading optimized image");var f=d.child(a.currentUser.uid).child(c.game.title+"/image"),g=f.put(b);g.on("state_changed",function a(b){var a=b.bytesTransferred/b.totalBytes*100;console.log("uploading image: "+a)},function(b){console.log("upload failed!")},function(){console.log("upload complete!"),c.game.imgUrl=g.snapshot.downloadURL,e()})})},j.src=optUrl}}})})}(),function(){a.onAuthStateChanged(b=>{a.currentUser||(alert("Please log in to add a game!"),location.href="login.html?from=editgame")})}(),function(){const b=document.getElementById("signup"),c=document.getElementById("signin"),d=document.getElementById("signout");d.addEventListener("click",b=>{a.signOut(),alert("You have succesfully signed out.")}),a.onAuthStateChanged(a=>{a?(console.log(a),console.log("logged in"),b.classList.add("hide"),c.classList.add("hide"),d.classList.remove("hide")):(console.log("not logged in"),b.classList.remove("hide"),c.classList.remove("hide"),d.classList.add("hide"))})}();